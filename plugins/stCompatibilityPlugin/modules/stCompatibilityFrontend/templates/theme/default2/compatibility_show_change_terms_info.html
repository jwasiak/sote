{literal}<script type="text/javascript" src="/js/jquery.cookie.js"></script>{/literal}
{if $isAuthenticated }
<div id="terms_overlay" style="min-height: 100px; height: auto;">
    <div class="terms_overlay_content" style="min-height: 100px; height: auto; padding: 20px 10px; text-align: center;">
        {$changeTermsDescription}
        
        <div class="buttons">
            <button  id="terms_overlay_button" type="submit" class="regular roundies" style="width: 40px;margin:30px auto 0px;float: none;">
                <span class="arrow_right">OK</span>
            </button>
        </div>
                
    </div>
</div>
{/if}

{literal}
<script type="text/javascript">
jQuery(function ($)
{
    $(document).ready(function()
    {   
        
        {/literal}{if $isAuthenticated }{literal}        
        
            if (!$.cookies.get('change_terms_message_hidden_{/literal}{$changeTermsCookieHash}{literal}')) {                            
                console.log('show message');                
                $('#terms_overlay').overlay({load: true});   
            }
            
        {/literal}{else}{literal}
            
            var change_terms = '<div id="change_terms_message" style="width: 100%; position:fixed; bottom:0; left: 0; z-index:1000; background: #{/literal}{$changeTermsBackground}{literal}; display: none"><div style="width: {/literal}{$changeTermsWidth}{literal}px; margin: 0 auto; z-index: 10000; position: relative; max-width: 100%;"><div id="change_terms_close" style="z-index:10001;background-image: url(/images/frontend/theme/default2/buttons/close_cookies.png);cursor: pointer; height: 14px; position: absolute; margin: 0px auto; right: 10px; top: 12px; width:13px;"></div><div id="change_terms_content" style="text-align:center; font-size: 12px; color:#{/literal}{$changeTermsColor}{literal}; padding: 10px 30px 10px 0px;">{/literal}{$changeTermsDescription}{literal}</div></div></div>';             
            $( "{/literal}{$last_div}{literal}" ).after(change_terms); 
                                               
             
            var change_terms_message = $('#change_terms_message');
            var height_change_terms_message = $('#change_terms_message').height();
            if (!$.cookies.get('change_terms_message_hidden_{/literal}{$changeTermsCookieHash}{literal}')) {
                change_terms_message.show();
                
                setTimeout(
                  function() 
                  {
                    if(!$.cookies.get('cookies_message_hidden')){
                        
                        $("#change_terms_content").css("padding-bottom", 0);
                        $("#cookies_content").css("padding-top", 0);
                        
                        var height_cookies_message = $('#cookies_message').height();
                        $("#change_terms_message").css("bottom", height_cookies_message);
                        $("#message_close").hide();  
                          
                    }
                  }, 100);
                                                                            
                  $("html").css("padding-bottom", height_change_terms_message);                                    
            }
            
        {/literal}{/if}{literal}

        
        function saveCookies(){
            var expires_at = new Date();
            var years = 20;
            expires_at.setTime(expires_at.getTime() + 1000 * years * 365 * 24 * 60 * 60);
            $.cookies.set('change_terms_message_hidden_{/literal}{$changeTermsCookieHash}{literal}', true, {path: '/', expiresAt: expires_at});
        }            

        $('#change_terms_close').click(function(){
            change_terms_message.hide();            
            saveCookies();              
            
             if(!$.cookies.get('cookies_message_hidden')){
                $('#cookies_message').hide();
                var expires_at = new Date();
                var years = 20;
                expires_at.setTime(expires_at.getTime() + 1000 * years * 365 * 24 * 60 * 60);
                $.cookies.set('cookies_message_hidden', true, {path: '/', expiresAt: expires_at});        
             }
                      
        });
        
        $('#terms_overlay .close').click(function(){           
            saveCookies();                        
        });
        
        $('#terms_overlay_button').click(function(){
            $("#terms_overlay").overlay().close();           
            saveCookies();                        
        });
                
    });
});
</script>
{/literal}